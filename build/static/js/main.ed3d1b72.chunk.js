(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{154:function(e,t){},158:function(e,t,n){},159:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(21),o=n.n(c),l=n(65),i=n(6),s=n(8),u=n(17),m=n(25),d=n(7),f=n(34),E=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).PORT||3e3,v={domain:"http://localhost:".concat(E),login:function(e,t){return v.fetch("/login",{method:"POST",body:{screenName:e,password:t}}).then((function(e){return v.setToken(e),e}))},register:function(e,t,n){return v.fetch("/register",{method:"POST",body:{screenName:e,email:t,password:n}})},loggedIn:function(){var e=v.getToken();return!!e&&!v.isTokenExpired(e)},isTokenExpired:function(e){try{return Object(f.a)(e).exp<Date.now()/1e3}catch(t){return!1}},setToken:function(e){localStorage.setItem("id_token",e)},getToken:function(){return localStorage.getItem("id_token")},logout:function(){localStorage.clear()},getProfile:function(){return Object(f.a)(v.getToken())},fetch:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){t.body=JSON.stringify(t.body);var n={Accept:"application/json","Content-Type":"application/json"};return v.loggedIn()&&(n.Authorization="Bearer "+v.getToken()),fetch(v.domain+e,Object(d.a)({headers:n},t)).then(v._checkStatus).then((function(e){return e.json()}))})),_checkStatus:function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}},p=v;function b(e,t){var n=Object(a.useState)((function(){var n=localStorage.getItem(e);return null!==n?JSON.parse(n):"function"===typeof t?t():t})),r=Object(i.a)(n,2),c=r[0],o=r[1];return Object(a.useEffect)((function(){localStorage.setItem(e,JSON.stringify(c))}),[e,c]),[c,o]}var g=function(e){var t=Object(a.useState)({screenName:"",password:"",error:!1}),n=Object(i.a)(t,2),c=n[0],o=n[1],l=function(e){var t=e.target,n=t.name,a=t.value;o((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(m.a)({},n,a))}))},s=b("screenName"),E=Object(i.a)(s,2),v=(E[0],E[1]),g=b("contacts"),h=Object(i.a)(g,2),O=h[0],j=h[1],C=b("chatID"),y=Object(i.a)(C,2),x=(y[0],y[1]),N=b("id"),S=Object(i.a)(N,2),k=(S[0],S[1]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Login"),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"screenName"},"Username"),r.a.createElement("input",{onChange:l,type:"text",id:"screenName",name:"screenName",required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{onChange:l,type:"password",id:"password",name:"password",required:!0})),r.a.createElement("button",{type:"submit",onClick:function(t){t.preventDefault(),p.login(c.screenName,c.password).then((function(e){var t=Object(f.a)(e);console.log("contacts >>>: ",O),v(t.screenName),j(t.contacts),x(t.chatID),k(t.id),o((function(e){return Object(d.a)(Object(d.a)({},e),{},{error:!1})}))})).then((function(){e.history.push("/home")})).catch((function(e){o((function(e){return Object(d.a)(Object(d.a)({},e),{},{error:!0})}))}))}},"Login"),r.a.createElement("p",null,r.a.createElement(u.c,{to:"/register"}," Register ")),c.error?r.a.createElement("div",null,"Email/password invalid"):r.a.createElement("div",null))},h=n(32),O=n.n(h),j=function(){var e=Object(a.useState)({screenName:"",email:"",password:"",registered:!1,error:!1}),t=Object(i.a)(e,2),n=t[0],c=t[1],o=function(e){var t=e.target,n=t.name,a=t.value;c((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(m.a)({},n,a))}))};return r.a.createElement(r.a.Fragment,null,!1===n.registered?r.a.createElement("div",null,r.a.createElement("h1",null,"Register"),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"name"},"Username"),r.a.createElement("input",{type:"text",id:"screenName",name:"screenName",onChange:o,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"name"},"Email"),r.a.createElement("input",{type:"email",id:"email",name:"email",onChange:o})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",name:"password",onChange:o,required:!0})),r.a.createElement("button",{type:"submit",onClick:function(e){e.preventDefault();var t=n.screenName,a=n.email,r=n.password;p.register(t,a,r).then((function(e){c((function(e){return Object(d.a)(Object(d.a)({},e),{},{error:!1,registered:!0})}))})).catch((function(e){console.log("error registering: ",e),c((function(e){return Object(d.a)(Object(d.a)({},e),{},{error:!0})})),console.error(e)}))}},"Register"),!0===n.error?r.a.createElement("div",null,"Username is already taken"):r.a.createElement("div",null),r.a.createElement("p",null,r.a.createElement(u.b,{to:"/"},"Login"))):r.a.createElement("div",null,"Successfully registered",r.a.createElement("p",null,r.a.createElement(u.b,{to:"/home"},"Go Login"))))},C=n(166),y=n(165),x=n(161),N=n(163),S=n(167),k=n(28),w=r.a.createContext();function I(){return Object(a.useContext)(w)}function T(e){var t=e.children,n=b("contacts"),a=Object(i.a)(n,2),c=a[0],o=a[1],l=b("id"),s=Object(i.a)(l,2),u=s[0];s[1];return r.a.createElement(w.Provider,{value:{contacts:c,addContact:function(e){O.a.post("http://localhost:3000/contacts",{id:u,newContact:e}).then((function(e){O.a.get("http://localhost:3000/contacts/".concat(u)).then((function(e){o(e.data.contacts)}))})).catch((function(e){console.log(e)}))}}},t)}var P=r.a.createContext();function D(){return Object(a.useContext)(P)}function M(e){var t=e.id,n=e.children,c=b("conversations",[]),o=Object(i.a)(c,2),l=o[0],s=o[1],u=Object(a.useState)(0),m=Object(i.a)(u,2),f=m[0],E=m[1],v=I().contacts;var p=Object(a.useCallback)((function(e){var t=e.recipients,n=e.text,a=e.sender;s((function(e){var r=!1,c={sender:a,text:n},o=e.map((function(e){return n=e.recipients,a=t,n.length===a.length&&(n.sort(),a.sort(),n.every((function(e,t){return e===a[t]})))?(r=!0,Object(d.a)(Object(d.a)({},e),{},{messages:[].concat(Object(k.a)(e.messages),[c])})):e;var n,a}));return r?o:[].concat(Object(k.a)(e),[{recipients:t,messages:[c]}])}))}),[s]);var g=l.map((function(e,n){var a=e.recipients.map((function(e){var t=v.find((function(t){return t.id===e})),n=t&&t.name||e;return{id:e,name:n}})),r=e.messages.map((function(e){var n=v.find((function(t){return t.id===e.sender})),a=n&&n.name||e.sender,r=t===e.sender;return Object(d.a)(Object(d.a)({},e),{},{senderName:a,fromMe:r})})),c=n===f;return Object(d.a)(Object(d.a)({},e),{},{messages:r,recipients:a,selected:c})})),h={conversations:g,createConversation:function(e){s((function(t){return[].concat(Object(k.a)(t),[{recipients:e,messages:[]}])}))},selectConversationIndex:E,selectedConversation:g[f],sendMessage:function(e,n){p({recipients:e,text:n,sender:t})}};return r.a.createElement(P.Provider,{value:h},n)}function _(){var e=D(),t=e.conversations,n=e.selectConversationIndex;return console.log("the conversationssss ",t),r.a.createElement(S.a,{variant:"flush"},t.map((function(e,t){return r.a.createElement(S.a.Item,{key:t,action:!0,onClick:function(){return n(t)},active:e.selected},e.recipients.map((function(e){return e.name})).join(", "))})))}function L(){var e=I().contacts;return console.log("contacts~~~~   ",e),r.a.createElement(S.a,{variant:"flush"},e?e.map((function(e){return r.a.createElement(S.a.Item,{key:e.id},e.name)})):r.a.createElement("div",null,"Loading..."))}var F=n(164);function K(e){var t=e.closeModal,n=Object(a.useState)([]),c=Object(i.a)(n,2),o=c[0],l=c[1],s=I().contacts,u=D().createConversation;return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a.Header,{closeButton:!0}," Create Conversation "),r.a.createElement(N.a.Body,null,r.a.createElement(F.a,{onSubmit:function(e){e.preventDefault(),console.log("the selcted:    ",o),u(o),t()}},s.map((function(e){return r.a.createElement(F.a.Group,{controlId:e.id,key:e.id},r.a.createElement(F.a.Check,{type:"checkbox",value:o.includes(e.id),label:e.name,onChange:function(){var t;t=e.id,l((function(e){return e.includes(t)?e.filter((function(e){return t!==e})):[].concat(Object(k.a)(e),[t])}))}}))})),r.a.createElement(x.a,{type:"submit"},"Submit"))))}function R(e){var t=e.closeModal,n=Object(a.useRef)(),c=(Object(a.useRef)(),I().addContact);return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a.Header,{closeButton:!0}," New Contact "),r.a.createElement(N.a.Body,null,r.a.createElement(F.a,{onSubmit:function(e){e.preventDefault(),c(n.current.value),t()}},r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null," Id "),r.a.createElement(F.a.Control,{type:"text",ref:n,required:!0})),r.a.createElement(x.a,{type:"submit"},"Add"))))}var B=n(36),A=n(37);function q(){var e=Object(a.useState)("Conversations"),t=Object(i.a)(e,2),n=t[0],c=t[1],o="Conversations"===n,l=Object(a.useState)(!1),s=Object(i.a)(l,2),u=s[0],m=s[1];function d(){m(!1)}return r.a.createElement("div",{style:{width:"300px"},className:"d-flex flex-column"},r.a.createElement(C.a.Container,{activeKey:n,onSelect:c},r.a.createElement(y.a,{variant:"tabs",className:"justify-content-center nav-fill"},r.a.createElement(y.a.Item,null,r.a.createElement(y.a.Link,{eventKey:"Conversations"},r.a.createElement(B.a,{icon:A.a})," \xa0Conversations ")),r.a.createElement(y.a.Item,null,r.a.createElement(y.a.Link,{eventKey:"Contacts"},r.a.createElement(B.a,{icon:A.c})," \xa0Contacts "))),r.a.createElement(C.a.Content,{className:"border-right overflow-auto flex-grow-1"},r.a.createElement(C.a.Pane,{eventKey:"Conversations"},r.a.createElement(_,null)),r.a.createElement(C.a.Pane,{eventKey:"Contacts"},r.a.createElement(L,null))),r.a.createElement("div",{className:"p-2 border-top border-right small"},"Your Id: ",r.a.createElement("span",{className:"text-muted"},localStorage.getItem("id")),r.a.createElement("div",null," Screen Name: ",r.a.createElement("span",{className:"text-muted"},localStorage.getItem("screenName")))),r.a.createElement(x.a,{onClick:function(){return m(!0)},className:"rounded-0"},o?"Start Conversation":"Add Contact")),r.a.createElement(N.a,{show:u,onHide:d},o?r.a.createElement(K,{closeModal:d}):r.a.createElement(R,{closeModal:d})))}var H=n(162);function z(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],o=D(),l=o.sendMessage,s=o.selectedConversation,u=Object(a.useCallback)((function(e){e&&e.scrollIntoView({smooth:!0})}));function m(e){e.preventDefault(),l(s.recipients.map((function(e){return e.id})),n),c("")}return r.a.createElement("div",{className:"open-convo d-flex flex-column flex-grow-1",style:{height:"88vh"}},r.a.createElement("div",{className:"convo overflow-auto"},r.a.createElement("div",{className:"d-flex flex-column px-3"},s.messages.map((function(e,t){var n=s.messages.length-1===t;return r.a.createElement("div",{key:t,ref:n?u:null,className:"my-1 d-flex flex-column ".concat(e.fromMe?"align-self-end align-items-end":"align-items-start")},r.a.createElement("div",{className:"rounded px-3 py-2 \n                  ".concat(e.fromMe?"bg-primary text-white":"border")},e.text),r.a.createElement("div",{className:"text-muted small ".concat(e.fromMe?"text-right":"")},e.fromMe?"You":e.senderName))})))),r.a.createElement(F.a,{onSubmit:m},r.a.createElement(F.a.Group,{className:"m-2"},r.a.createElement(H.a,null,r.a.createElement(F.a.Control,{as:"textarea",className:"rounded-0 send-txt",required:!0,value:n,onChange:function(e){return c(e.target.value)},style:{height:"60px",resize:"none"},onKeyPress:function(e){"Enter"===e.key&&m(e)}}),r.a.createElement(H.a.Append,null,r.a.createElement(x.a,{type:"submit",className:"rounded-0"},r.a.createElement(B.a,{icon:A.b}),"\xa0\xa0Send "))))))}function J(e){var t=Object(s.f)();return r.a.createElement("div",{className:"ribbon"},r.a.createElement("div",null,"Ribbon Text"),r.a.createElement(x.a,{className:"logout float-right",variant:"secondary",size:"sm",onClick:function(){localStorage.clear(),t.push("/")}},"Logout")," ")}function U(e){var t=D().selectedConversation;return console.log("selected conversation in home  ",t),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"d-flex",style:{height:"100vh "}},r.a.createElement(q,null),r.a.createElement(J,null),t&&r.a.createElement(z,null)))}var G=function(){return r.a.createElement("div",{className:"container"},"This page is unauthorized. Please login.",r.a.createElement("p",null,r.a.createElement(u.b,{to:"/"},"Back to Home")))};n(98),r.a.createContext();var W=function(){var e=b("id"),t=Object(i.a)(e,2),n=t[0],a=(t[1],function(e){var t=e.component,n=Object(l.a)(e,["component"]);return r.a.createElement(s.b,Object.assign({},n,{render:function(e){return!0===p.loggedIn()?r.a.createElement(t,e):r.a.createElement(s.a,{to:"/"})}}))}),c=function(e){var t=e.component,n=Object(l.a)(e,["component"]);return r.a.createElement(s.b,Object.assign({},n,{render:function(e){return!0===p.loggedIn()?r.a.createElement(s.a,{to:"/home"}):r.a.createElement(t,e)}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(T,null,r.a.createElement(M,{id:n},r.a.createElement("div",{className:"App"},r.a.createElement(u.a,null,r.a.createElement(c,{exact:!0,path:"/",component:g}),r.a.createElement(c,{exact:!0,path:"/register",component:j}),r.a.createElement(a,{exact:!0,path:"/home",component:U}),r.a.createElement(s.b,{exact:!0,path:"/unauthorized",component:G}))))))};n(157),n(158);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(W,null)),document.getElementById("root"))},99:function(e,t,n){e.exports=n(159)}},[[99,1,2]]]);
//# sourceMappingURL=main.ed3d1b72.chunk.js.map